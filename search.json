[{"title":"Brotato + DLC 難度 5 建議(全角色) + 新構建(中翻)","url":"/2024/11/26/brotato/","content":"<p><img src=\"/images/bratato.jpg\" alt=\"brotato.jpg\"><br>\n<a href=\"https://steamcommunity.com/sharedfiles/filedetails/?id=3018964960\">文章原文</a></p>\n<h2 id=\"概述\">概述</h2>\n<p>在本文中我會提供我每一個角色在進行難度 5 遊戲的建議與構建<br>\n圖片可能會怪怪的，因為我用 Steam Deck 玩</p>\n<h2 id=\"一般建議\">一般建議</h2>\n<p>不要小看<code>運氣(Luck)</code>與<code>收穫(Harvesting)</code><br>\n你越早拿到運氣跟收穫，後面的回報越多<br>\n下面是個例子<br>\n<img src=\"/images/harvestExample.jpg\" alt=\"harvestExample.jpg\"><br>\n這並非意味著每次都必須選擇<code>收穫(Harvesting)</code>但越早提升收益越大<br>\n<code>運氣(Luck)</code>也是同理，越早提升可以有更好的商店選擇與升級選項<br>\n所以如果你在難度 5 下某些角色玩得很吃力，可以嘗試在前期提升<code>收穫(Harvesting)</code>和<code>運氣(Luck)</code><br>\n或許會讓你玩起來較舒服<br>\n下圖說明<code>運氣(Luck)</code>如何影響遊戲<br>\n<img src=\"/images/luck.png\" alt=\"lucky.png\"><br>\n然後下圖說明<code>運氣(Luck)</code>數值對商店的影響，但不要忘記升級異形素材掉落<br>\n<img src=\"/images/luckShop.jpg\" alt=\"luckShop.jpg\"><br>\n一般而言，你不需要太多就可以完成難度 5，只需要了解角色跟物品的聯動</p>\n<h2 id=\"消耗品、治療與寶箱-重要\">消耗品、治療與寶箱(重要!!!)</h2>\n<p>😱<code>除非需要補血，請不要拾取消耗品跟寶箱</code>😱<br>\n因為如果你滿血拾取，將不會獲得任何效益<br>\n消耗品跟寶箱在波數結束的時候會自動拾取<br>\n<img src=\"/images/healPick.jpg\" alt=\"healPick.jpg\"><br>\n<img src=\"/images/lootCrate.jpg\" alt=\"lootCrate.jpg\"><br>\n這個技巧適合用於你想要秒殺菁英怪，因為他會掉落一個傳奇寶箱可以回復 100HP<br>\n如果你滿血就保留到需要的時候再用<br>\n這是一個很有用的策略，但常常被忽略<br>\n所以滿血的時候，就不要撿消耗品跟寶箱</p>\n<p>除非你的操作很神，要不然你一定會需要補血，他會在關鍵時刻救你一命 🤡<br>\n<img src=\"/images/healBuff.jpg\" alt=\"healBuff.jpg\"></p>\n<h2 id=\"難度-5-推薦物品-I-got-you\">難度 5 推薦物品!!!(I got you)</h2>\n<p>有些物品可以極大的幫助你通過難度 5<br>\n首選是妖精(Fairy)幾乎必選，其餘的可以參考下圖<br>\n建議在較低的難度解鎖這些裝備，這樣你就可以在難度 5 使用它<br>\n<img src=\"/images/betterItem.jpg\" alt=\"betterItem.jpg\"></p>\n<h2 id=\"S-Tier-Items\">S-Tier Items</h2>\n<p>為什麼要盡量取得這些裝備???</p>\n<ul>\n<li>讓你遊戲更順利</li>\n<li>巨大價值，且幾乎回本</li>\n<li>傷害越高，你殺敵的速度就越快，殺的敵人越多，你獲得的材料也就越多。</li>\n<li>越早獲得圖片中 S 級裝備裡那些提供收穫（Harvesting）的裝備，它們回本的速度就越快。</li>\n</ul>\n<p><strong>注意!!!</strong><br>\n為什麼那些可以<code>增加敵人數量</code>的裝備是好東西??<br>\n因為每回合刷新的敵人越多，整場遊戲中獲得的材料也會越多。因此，記得留意這類裝備。</p>\n<p>但也要留心，有些裝備在第 15 波之後就不太值得拿了，具體取決於你獲得它們的時間。<br>\n以下列出的裝備幾乎適用於遊戲中每個角色，所以它們被歸入了 S 級。<br>\n<img src=\"/images/SRankItems.jpg\" alt=\"SRankItems.jpg\"></p>\n<p><strong>特別</strong><br>\n為什麼選擇 Ugly Tooth??<br>\n如果你覺得你常常被菁英怪或 BOSS 貼著打或是覺得移動速度不夠躲怪那就選它<br>\n它是遊戲中影響力最大的裝備之一，特別是在你的跑圖狀況不穩的時候，能起到很大的作用<br>\n如果你目前可以輕鬆清場，那就不需要它<br>\n<img src=\"/images/uglyTooth.jpg\" alt=\"uglyTooth.jpg\"></p>\n<h2 id=\"F-Tier-Items-幾乎不選\">F-Tier Items(幾乎不選)</h2>\n<p>為甚麼要盡量避免選擇這些物品</p>\n<h2 id=\"參考資料\">參考資料</h2>\n<ul>\n<li><a href=\"https://steamcommunity.com/sharedfiles/filedetails/?id=3018964960\">https://steamcommunity.com/sharedfiles/filedetails/?id=3018964960</a></li>\n<li><a href=\"https://brotato.wiki.spellsandguns.com/Brotato_Wiki\">https://brotato.wiki.spellsandguns.com/Brotato_Wiki</a></li>\n</ul>\n","categories":["遊戲"],"tags":["遊戲"]},{"title":"C# 使用 curl.exe 呼叫api","url":"/2024/11/19/curl/","content":"<h2 id=\"概述\">概述</h2>\n<p>有時候開發軟體的版本過舊，導致介接 API 會異常困難<br>\n學長說可以用 curl 來呼叫 api，所以就來看看怎麼用</p>\n<h2 id=\"DownLoad-curl-exe\">DownLoad curl.exe</h2>\n<p><a href=\"https://curl.se/download.html#Win64\">https://curl.se/download.html#Win64</a></p>\n<h2 id=\"CurlHelper-cs\">CurlHelper.cs</h2>\n<pre><code class=\"highlight C#\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">CurlHelper</span>\n    &#123;\n        <span class=\"comment\">// curl.exe 路徑</span>\n        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">readonly</span> <span class=\"built_in\">string</span> CurlPath = <span class=\"string\">$&quot;C:\\\\AP06BZ\\\\EXE\\\\CURL.EXE&quot;</span>;\n\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> Get 請求</span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;url&quot;&gt;</span><span class=\"doctag\">&lt;/param&gt;</span></span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;headers&quot;&gt;</span><span class=\"doctag\">&lt;/param&gt;</span></span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span><span class=\"doctag\">&lt;/returns&gt;</span></span>\n        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"built_in\">string</span> <span class=\"title\">GetRequest</span>(<span class=\"params\"><span class=\"built_in\">string</span> url, Dictionary&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">string</span>&gt; headers = <span class=\"literal\">null</span></span>)</span>\n        &#123;\n            <span class=\"built_in\">string</span> arugments = <span class=\"string\">$&quot;-X GET \\&quot;<span class=\"subst\">&#123;url&#125;</span>\\&quot;&quot;</span>;\n            <span class=\"keyword\">if</span> (headers != <span class=\"literal\">null</span>)\n            &#123;\n                <span class=\"keyword\">foreach</span> (<span class=\"keyword\">var</span> header <span class=\"keyword\">in</span> headers)\n                &#123;\n                    arugments += <span class=\"string\">$&quot; -H \\&quot;<span class=\"subst\">&#123;header.Key&#125;</span>: <span class=\"subst\">&#123;header.Value&#125;</span>\\&quot;&quot;</span>;\n                &#125;\n            &#125;\n            <span class=\"keyword\">return</span> ExecuteCurlCommand(arugments);\n        &#125;\n\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> POST 請求(JSON資料)</span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;url&quot;&gt;</span><span class=\"doctag\">&lt;/param&gt;</span></span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;jsonData&quot;&gt;</span><span class=\"doctag\">&lt;/param&gt;</span></span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;headers&quot;&gt;</span><span class=\"doctag\">&lt;/param&gt;</span></span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span><span class=\"doctag\">&lt;/returns&gt;</span></span>\n        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"built_in\">string</span> <span class=\"title\">PostRequest</span>(<span class=\"params\"><span class=\"built_in\">string</span> url, <span class=\"built_in\">string</span> jsonData, Dictionary&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">string</span>&gt; headers = <span class=\"literal\">null</span></span>)</span>\n        &#123;\n            <span class=\"built_in\">string</span> arguments = <span class=\"string\">$&quot;-X POST -H \\&quot;Content-Type: application/json\\&quot; -d \\&quot;<span class=\"subst\">&#123;jsonData&#125;</span>\\&quot; \\&quot;<span class=\"subst\">&#123;url&#125;</span>\\&quot;&quot;</span>;\n            <span class=\"keyword\">if</span> (headers != <span class=\"literal\">null</span>)\n            &#123;\n                <span class=\"keyword\">foreach</span> (<span class=\"keyword\">var</span> header <span class=\"keyword\">in</span> headers)\n                &#123;\n                    arguments += <span class=\"string\">$&quot; -H \\&quot;<span class=\"subst\">&#123;header.Key&#125;</span>: <span class=\"subst\">&#123;header.Value&#125;</span>\\&quot;&quot;</span>;\n                &#125;\n            &#125;\n            <span class=\"keyword\">return</span> ExecuteCurlCommand(arguments);\n        &#125;\n\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> POST 請求(表單資料)</span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;url&quot;&gt;</span><span class=\"doctag\">&lt;/param&gt;</span></span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;formData&quot;&gt;</span><span class=\"doctag\">&lt;/param&gt;</span></span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;headers&quot;&gt;</span><span class=\"doctag\">&lt;/param&gt;</span></span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span><span class=\"doctag\">&lt;/returns&gt;</span></span>\n        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"built_in\">string</span> <span class=\"title\">PostFormRequest</span>(<span class=\"params\"><span class=\"built_in\">string</span> url, Dictionary&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">string</span>&gt; formData, Dictionary&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">string</span>&gt; headers = <span class=\"literal\">null</span></span>)</span>\n        &#123;\n            <span class=\"built_in\">string</span> arguments = <span class=\"string\">&quot;-X POST&quot;</span>;\n            <span class=\"keyword\">foreach</span> (<span class=\"keyword\">var</span> item <span class=\"keyword\">in</span> formData)\n            &#123;\n                arguments += <span class=\"string\">$&quot; -F \\&quot;<span class=\"subst\">&#123;item.Key&#125;</span>=<span class=\"subst\">&#123;item.Value&#125;</span>\\&quot;&quot;</span>;\n            &#125;\n            arguments += <span class=\"string\">$&quot; \\&quot;<span class=\"subst\">&#123;url&#125;</span>\\&quot;&quot;</span>;\n            <span class=\"keyword\">if</span> (headers != <span class=\"literal\">null</span>)\n            &#123;\n                <span class=\"keyword\">foreach</span> (<span class=\"keyword\">var</span> header <span class=\"keyword\">in</span> headers)\n                &#123;\n                    arguments += <span class=\"string\">$&quot; -H \\&quot;<span class=\"subst\">&#123;header.Key&#125;</span>: <span class=\"subst\">&#123;header.Value&#125;</span>\\&quot;&quot;</span>;\n                &#125;\n            &#125;\n            <span class=\"keyword\">return</span> ExecuteCurlCommand(arguments);\n        &#125;\n\n\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> 執行curl命令返回輸出</span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name=&quot;arguments&quot;&gt;</span><span class=\"doctag\">&lt;/param&gt;</span></span>\n        <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span><span class=\"doctag\">&lt;/returns&gt;</span></span>\n        <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"built_in\">string</span> <span class=\"title\">ExecuteCurlCommand</span>(<span class=\"params\"><span class=\"built_in\">string</span> arguments</span>)</span>\n        &#123;\n            <span class=\"keyword\">var</span> startInfo = <span class=\"keyword\">new</span> ProcessStartInfo\n            &#123;\n                FileName = CurlPath,\n                Arguments = arguments,\n                RedirectStandardOutput = <span class=\"literal\">true</span>,\n                UseShellExecute = <span class=\"literal\">false</span>,\n                CreateNoWindow = <span class=\"literal\">true</span>,\n            &#125;;\n            <span class=\"keyword\">using</span> (<span class=\"keyword\">var</span> p = Process.Start(startInfo))\n            &#123;\n                <span class=\"keyword\">using</span> (<span class=\"keyword\">var</span> reader = p.StandardOutput)\n                &#123;\n                    <span class=\"keyword\">return</span> reader.ReadToEnd();\n                &#125;\n            &#125;\n        &#125;\n    &#125;</code></pre>\n<h2 id=\"Usage\">Usage</h2>\n<pre><code class=\"highlight C#\"><span class=\"built_in\">string</span> url = <span class=\"string\">&quot;apiurl...&quot;</span>;\n<span class=\"keyword\">var</span> headers = <span class=\"keyword\">new</span> Dictionary&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">string</span>&gt;\n&#123;\n      &#123;<span class=\"string\">&quot;Authorization&quot;</span>, <span class=\"string\">&quot;Bearer your_api_key&quot;</span>&#125;\n&#125;;\n<span class=\"built_in\">string</span> response = CurlHelper.GetRequest(url, headers);\nConsole.WriteLine(<span class=\"string\">&quot;Get Response: &quot;</span> + response);</code></pre>\n","categories":["CSharp","Curl"],"tags":["CSharp","Curl"]},{"title":"Hello World","url":"/2024/11/19/hello-world/","content":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\">Quick Start</h2>\n<h3 id=\"Create-a-new-post\">Create a new post</h3>\n<pre><code class=\"highlight bash\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></code></pre>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\">Run server</h3>\n<pre><code class=\"highlight bash\">$ hexo server</code></pre>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\">Generate static files</h3>\n<pre><code class=\"highlight bash\">$ hexo generate</code></pre>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\">Deploy to remote sites</h3>\n<pre><code class=\"highlight bash\">$ hexo deploy</code></pre>\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n"},{"title":"C# 資料快取","url":"/2024/11/20/imemorycahce/","content":"<h2 id=\"概述\">概述</h2>\n<p>有時候一些大型資料且異動少的資料<br>\n每次使用就要從資料重新撈取就很浪費效能資源<br>\n這個時候就是快取出場的時候</p>\n<h2 id=\"Install\">Install</h2>\n<pre><code class=\"highlight powershell\">dotnet add package Microsoft.Extensions.Caching.Memory</code></pre>\n<h2 id=\"Extensions-cs\">Extensions.cs</h2>\n<pre><code class=\"highlight C#\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">AddExtension</span>(<span class=\"params\"><span class=\"keyword\">this</span> IServiceCollection services</span>)</span>\n&#123;\n    services.AddMemoryCache();\n    <span class=\"comment\">// services.AddScoped&lt;CacheHelper&gt;(); //如果有使用整合工具類</span>\n&#125;</code></pre>\n<h2 id=\"Usage\">Usage</h2>\n<pre><code class=\"highlight C#\">[<span class=\"meta\">Route(<span class=\"string\">&quot;api/[controller]&quot;</span>)</span>]\n [<span class=\"meta\">ApiController</span>]\n <span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">DataController</span> : <span class=\"title\">ControllerBase</span>\n &#123;\n     <span class=\"keyword\">private</span> <span class=\"keyword\">readonly</span> DataBaseService dataBaseService;\n     <span class=\"keyword\">private</span> <span class=\"keyword\">readonly</span> IMemoryCache memoryCache;\n\n     <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">DataController</span>(<span class=\"params\">DataBaseService dataBaseService, IMemoryCache memoryCache</span>)</span>\n     &#123;\n         <span class=\"keyword\">this</span>.memoryCache = memoryCache;\n         <span class=\"keyword\">this</span>.dataBaseService = dataBaseService;\n     &#125;\n\n     [<span class=\"meta\">HttpGet(<span class=\"string\">&quot;/search&quot;</span>)</span>]\n     <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">async</span> Task&lt;IActionResult&gt; <span class=\"title\">Search</span>(<span class=\"params\"><span class=\"built_in\">string</span> keyword</span>)</span>\n     &#123;\n        <span class=\"comment\">// 從記憶體快取查看是否存在，沒再去資料庫撈資料並儲存快取</span>\n         <span class=\"keyword\">if</span> (memoryCache.TryGetValue(<span class=\"string\">&quot;MainDataCache&quot;</span>, <span class=\"keyword\">out</span> List&lt;Prs006&gt; dataList))\n         &#123;\n             <span class=\"keyword\">var</span> result = dataList?\n                 .Where(data =&gt; data.Ordnme?.Contains(keyword, StringComparison.OrdinalIgnoreCase) == <span class=\"literal\">true</span>\n                                || data.Scitn?.Contains(keyword, StringComparison.OrdinalIgnoreCase) == <span class=\"literal\">true</span>\n                                || data.Keyword?.Contains(keyword, StringComparison.OrdinalIgnoreCase) == <span class=\"literal\">true</span>)\n                 .ToList() ?? <span class=\"keyword\">new</span> List&lt;Prs006&gt;();\n\n             <span class=\"keyword\">return</span> Ok(result);\n         &#125;\n         <span class=\"keyword\">else</span>\n         &#123;\n             <span class=\"keyword\">var</span> dbData = <span class=\"keyword\">await</span> dataBaseService.GetDatas();\n             <span class=\"comment\">//寫入記憶體儲存，一天後自動過期</span>\n             memoryCache.Set(<span class=\"string\">&quot;MainDataCache&quot;</span>, dbData, TimeSpan.FromDays(<span class=\"number\">1</span>));\n\n             <span class=\"keyword\">var</span> result = dbData?\n                 .Where(data =&gt; data.Ordnme?.Contains(keyword, StringComparison.OrdinalIgnoreCase) == <span class=\"literal\">true</span>\n                                || data.Scitn?.Contains(keyword, StringComparison.OrdinalIgnoreCase) == <span class=\"literal\">true</span>\n                                || data.Keyword?.Contains(keyword, StringComparison.OrdinalIgnoreCase) == <span class=\"literal\">true</span>)\n                 .ToList() ?? <span class=\"keyword\">new</span> List&lt;Prs006&gt;();\n\n             <span class=\"keyword\">return</span> Ok(result);\n         &#125;\n     &#125;</code></pre>\n<h2 id=\"CacheHelper-cs-Optional\">CacheHelper.cs(Optional)</h2>\n<pre><code class=\"highlight C#\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">CacheHelper</span>\n&#123;\n    <span class=\"keyword\">private</span> <span class=\"keyword\">readonly</span> IMemoryCache cache;\n\n    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">CacheHelper</span>(<span class=\"params\">IMemoryCache cache</span>)</span>\n    &#123;\n        <span class=\"keyword\">this</span>.cache = cache;\n    &#125;\n\n    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Set</span>&lt;<span class=\"title\">T</span>&gt;(<span class=\"params\"><span class=\"built_in\">string</span> key, T <span class=\"keyword\">value</span>, <span class=\"built_in\">int</span> expire = <span class=\"number\">300</span></span>)</span>\n    &#123;\n        <span class=\"keyword\">var</span> options = <span class=\"keyword\">new</span> MemoryCacheEntryOptions\n        &#123;\n            AbsoluteExpirationRelativeToNow = TimeSpan.FromSeconds(expire),\n        &#125;;\n        cache.Set(key, <span class=\"keyword\">value</span>, options);\n    &#125;\n\n    <span class=\"keyword\">public</span> T? Get&lt;T&gt;(<span class=\"built_in\">string</span> key)\n    &#123;\n        cache.TryGetValue&lt;T&gt;(key, <span class=\"keyword\">out</span> <span class=\"keyword\">var</span> <span class=\"keyword\">value</span>);\n        <span class=\"keyword\">return</span> <span class=\"keyword\">value</span>;\n    &#125;\n\n    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Remove</span>(<span class=\"params\"><span class=\"built_in\">string</span> key</span>)</span>\n    &#123;\n        cache.Remove(key);\n    &#125;\n\n    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Update</span>&lt;<span class=\"title\">T</span>&gt;(<span class=\"params\"><span class=\"built_in\">string</span> key, T <span class=\"keyword\">value</span>, <span class=\"built_in\">int</span> expire</span>)</span>\n    &#123;\n        cache.Remove(key);\n        Set&lt;T&gt;(key, <span class=\"keyword\">value</span>, expire);\n    &#125;\n\n    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"built_in\">bool</span> <span class=\"title\">Contains</span>(<span class=\"params\"><span class=\"built_in\">string</span> key</span>)</span>\n    &#123;\n        <span class=\"keyword\">return</span> cache.TryGetValue(key, <span class=\"keyword\">out</span> _);\n    &#125;\n&#125;</code></pre>\n","categories":["CSharp"],"tags":["CSharp","Cache"]},{"title":"C# Web api使用Quartz進行一次性排程","url":"/2024/11/19/quartz/","content":"<h2 id=\"Install\">Install</h2>\n<pre><code class=\"highlight powershell\"><span class=\"built_in\">Install-Package</span> Quartz.AspNetCore\n<span class=\"built_in\">Install-Package</span> Quartz.Extensions.DependencyInjection\n<span class=\"built_in\">Install-Package</span> Quartz.Serialization.Json</code></pre>\n<h2 id=\"appsetting-json\">appsetting.json</h2>\n<p>這邊使用 Oracle 資料庫做為持久化儲存<a href=\"https://github.com/quartznet/quartznet/tree/main/database/tables\">各類資料庫腳本</a></p>\n<pre><code class=\"highlight json\"><span class=\"attr\">&quot;Quartz&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span>\n  <span class=\"attr\">&quot;quartz.scheduler.instanceName&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;QuartzOracleScheduler&quot;</span><span class=\"punctuation\">,</span>\n  <span class=\"attr\">&quot;quartz.scheduler.instanceId&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;AUTO&quot;</span><span class=\"punctuation\">,</span>\n  <span class=\"attr\">&quot;quartz.jobStore.type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Quartz.Impl.AdoJobStore.JobStoreTX, Quartz&quot;</span><span class=\"punctuation\">,</span>\n  <span class=\"attr\">&quot;quartz.jobStore.useProperties&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;true&quot;</span><span class=\"punctuation\">,</span>\n  <span class=\"attr\">&quot;quartz.jobStore.dataSource&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;default&quot;</span><span class=\"punctuation\">,</span>\n  <span class=\"attr\">&quot;quartz.jobStore.tablePrefix&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;QRTZ_&quot;</span><span class=\"punctuation\">,</span>\n  <span class=\"attr\">&quot;quartz.jobStore.driverDelegateType&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Quartz.Impl.AdoJobStore.OracleDelegate, Quartz&quot;</span><span class=\"punctuation\">,</span>\n  <span class=\"attr\">&quot;quartz.dataSource.default.provider&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;OracleODPManaged&quot;</span><span class=\"punctuation\">,</span>\n  <span class=\"attr\">&quot;quartz.dataSource.default.connectionString&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Your Connection String&quot;</span>\n<span class=\"punctuation\">&#125;</span></code></pre>\n<h2 id=\"Job-cs\">Job.cs</h2>\n<pre><code class=\"highlight C#\"> <span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">SendTasJob</span> : <span class=\"title\">IJob</span>\n &#123;\n     <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">async</span> Task <span class=\"title\">Execute</span>(<span class=\"params\">IJobExecutionContext context</span>)</span>\n     &#123;\n         <span class=\"comment\">//Job要實作的內容</span>\n          <span class=\"keyword\">var</span> tasid = context.MergedJobDataMap.GetString(<span class=\"string\">&quot;tasid&quot;</span>);\n          <span class=\"keyword\">var</span> welcomeText = context.MergedJobDataMap.GetString(<span class=\"string\">&quot;welcomeText&quot;</span>);\n          Console.WriteLine(tasid + welcomeText);\n          <span class=\"keyword\">return</span> Task.CompletedTask;\n     &#125;\n&#125;</code></pre>\n<h2 id=\"Controller-cs\">Controller.cs</h2>\n<pre><code class=\"highlight C#\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">TasController</span> : <span class=\"title\">ControllerBase</span>\n&#123;\n\n    <span class=\"keyword\">private</span> <span class=\"keyword\">readonly</span> ISchedulerFactory schedulerFactory;\n    <span class=\"keyword\">private</span> <span class=\"keyword\">readonly</span> IdGenerator idGenerator;\n\n    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">TasController</span>(<span class=\"params\">ISchedulerFactory schedulerFactory,</span></span>\n<span class=\"params\"><span class=\"function\">                         IdGenerator idGenerator</span>)</span>\n    &#123;\n        <span class=\"keyword\">this</span>.schedulerFactory = schedulerFactory;\n        <span class=\"keyword\">this</span>.idGenerator = idGenerator;\n    &#125;\n\n    [<span class=\"meta\">HttpPost(<span class=\"string\">&quot;[action]&quot;</span>)</span>]\n    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">async</span> Task&lt;IActionResult&gt; <span class=\"title\">ScheduleTasJob</span>(<span class=\"params\">TasJobRequest request</span>)</span>\n    &#123;\n        <span class=\"comment\">// 使用 SchedulerFactory 取得 Scheduler</span>\n        <span class=\"keyword\">var</span> sch = <span class=\"keyword\">await</span> schedulerFactory.GetScheduler();\n       <span class=\"comment\">// 雪花算法產Id</span>\n        <span class=\"keyword\">var</span> jobid = idGenerator.CreateId();\n        <span class=\"keyword\">var</span> jobKey = <span class=\"keyword\">new</span> JobKey(<span class=\"string\">$&quot;TasJob-<span class=\"subst\">&#123;jobid&#125;</span>&quot;</span>, <span class=\"string\">&quot;TasJobs&quot;</span>);\n        <span class=\"keyword\">var</span> triggerKey = <span class=\"keyword\">new</span> TriggerKey(<span class=\"string\">$&quot;TasJobTrigger-<span class=\"subst\">&#123;jobid&#125;</span>&quot;</span>, <span class=\"string\">&quot;TasJobs&quot;</span>);\n\n        <span class=\"comment\">// 建立Job</span>\n        <span class=\"keyword\">var</span> job = JobBuilder.Create&lt;SendTasJob&gt;()\n            .WithIdentity(jobKey)\n             <span class=\"comment\">//key value 如果有開啟UseProperties 只能有string型別</span>\n            .UsingJobData(<span class=\"string\">&quot;tasid&quot;</span>, request.TasId)\n            .UsingJobData(<span class=\"string\">&quot;welcomeText&quot;</span>, request.WelcomeText)\n            .StoreDurably() <span class=\"comment\">// 使任務持久化</span>\n            .Build();\n\n        <span class=\"comment\">// 設定Trigger</span>\n        ITrigger trigger = TriggerBuilder.Create()\n            .WithIdentity(triggerKey)\n            .StartAt(request.ExecuteAt ?? DateTime.UtcNow) <span class=\"comment\">// 指定執行時間</span>\n            .WithSimpleSchedule(x =&gt; x\n                .WithMisfireHandlingInstructionFireNow() <span class=\"comment\">// 當排程錯過執行時間時立即執行</span>\n                .WithRepeatCount(<span class=\"number\">0</span>) <span class=\"comment\">//只執行一次</span>\n                )\n            .Build();\n\n        <span class=\"keyword\">try</span>\n        &#123;\n           <span class=\"keyword\">await</span> sch.ScheduleJob(job, trigger);\n           Console.WriteLine(<span class=\"string\">$&quot;Scheduled job successfully with JobKey: <span class=\"subst\">&#123;jobKey.Name&#125;</span> and TriggerKey: <span class=\"subst\">&#123;triggerKey.Name&#125;</span>&quot;</span>);\n        &#125;\n        <span class=\"keyword\">catch</span> (Exception ex)\n        &#123;\n            Console.WriteLine(<span class=\"string\">$&quot;Failed to schedule job with JobKey: <span class=\"subst\">&#123;jobKey.Name&#125;</span> and TriggerKey: <span class=\"subst\">&#123;triggerKey.Name&#125;</span>&quot;</span>, ex);\n            <span class=\"keyword\">return</span> StatusCode(<span class=\"number\">500</span>, <span class=\"string\">&quot;Failed to schedule job&quot;</span>);\n        &#125;\n\n        <span class=\"keyword\">return</span> Ok(<span class=\"string\">$&quot;Scheduled job successfully with Job: <span class=\"subst\">&#123;jobKey.Name&#125;</span> and Trigger: <span class=\"subst\">&#123;triggerKey.Name&#125;</span>&quot;</span>);\n    &#125;\n&#125;</code></pre>\n<h2 id=\"Program-cs\">Program.cs</h2>\n<pre><code class=\"highlight C#\"><span class=\"comment\">// 從 appsettings.json 載入 Quartz 配置</span>\nbuilder.Services.Configure&lt;QuartzOptions&gt;(builder.Configuration.GetSection(<span class=\"string\">&quot;Quartz&quot;</span>));\n\n<span class=\"comment\">// 加入 Quartz 服務</span>\nbuilder.Services.AddQuartz(q =&gt;\n&#123;\n    q.UseJobFactory&lt;MicrosoftDependencyInjectionJobFactory&gt;();\n\n    <span class=\"comment\">// 持久化</span>\n    q.UsePersistentStore(opt =&gt;\n    &#123;\n        opt.UseProperties = <span class=\"literal\">false</span>;\n        opt.UseOracle(configuration =&gt;\n        &#123;\n            configuration.ConnectionString = builder.Configuration[<span class=\"string\">&quot;Quartz:quartz.dataSource.default.connectionString&quot;</span>];\n        &#125;);\n        opt.UseNewtonsoftJsonSerializer();\n    &#125;);\n&#125;);\nbuilder.Services.AddQuartzServer(q =&gt; q.WaitForJobsToComplete = <span class=\"literal\">true</span>); <span class=\"comment\">//hosting server</span>\n<span class=\"comment\">//builder.Services.AddQuartzHostedService(options =&gt;</span>\n<span class=\"comment\">//&#123;</span>\n<span class=\"comment\">//    // when shutting down we want jobs to complete gracefully</span>\n<span class=\"comment\">//    options.WaitForJobsToComplete = true;</span>\n<span class=\"comment\">//&#125;);</span>\nbuilder.Services.AddTransient&lt;SendTasJob&gt;(); <span class=\"comment\">// Job註冊</span>\n</code></pre>\n<h2 id=\"AddQuartzServer-vs-AddQuartzHostedService\">AddQuartzServer vs AddQuartzHostedService</h2>\n<p>AddQuartzServer 會多一個 Health Check 檢查 scheduler<br>\nSource Code 如下</p>\n<pre><code class=\"highlight C#\"><span class=\"keyword\">using</span> System;\n\n<span class=\"keyword\">using</span> Microsoft.Extensions.DependencyInjection;\n\n<span class=\"meta\">#<span class=\"keyword\">if</span> SUPPORTS_HEALTH_CHECKS</span>\n<span class=\"keyword\">using</span> Quartz.AspNetCore.HealthChecks;\n<span class=\"meta\">#<span class=\"keyword\">endif</span></span>\n\n<span class=\"keyword\">namespace</span> <span class=\"title\">Quartz</span>\n&#123;\n    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title\">QuartzServiceCollectionExtensions</span>\n    &#123;\n        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> IServiceCollection <span class=\"title\">AddQuartzServer</span>(<span class=\"params\"></span></span>\n<span class=\"params\"><span class=\"function\">            <span class=\"keyword\">this</span> IServiceCollection services,</span></span>\n<span class=\"params\"><span class=\"function\">            Action&lt;QuartzHostedServiceOptions&gt;? configure = <span class=\"literal\">null</span></span>)</span>\n        &#123;\n            <span class=\"meta\">#<span class=\"keyword\">if</span> SUPPORTS_HEALTH_CHECKS</span>\n            services\n                .AddHealthChecks()\n                .AddTypeActivatedCheck&lt;QuartzHealthCheck&gt;(<span class=\"string\">&quot;quartz-scheduler&quot;</span>);\n            <span class=\"meta\">#<span class=\"keyword\">endif</span></span>\n\n            <span class=\"keyword\">return</span> services.AddQuartzHostedService(configure);\n        &#125;\n    &#125;\n&#125;</code></pre>\n<h2 id=\"IIS-回收機制，排程失效\">IIS 回收機制，排程失效</h2>\n<ul>\n<li>關閉回收機制(程式應用集區 =&gt; 進階設定)<br>\n<img src=\"/images/InetMgr_ndjANFedAK.png\" alt=\"InetMgr_ndjANFedAK.png\"><br>\n<img src=\"/images/InetMgr_8EXFtPapjN.png\" alt=\"InetMgr_8EXFtPapjN.png\"></li>\n<li>定期呼叫 api 維持 server keep alive (ex.使用 window 排程)</li>\n</ul>\n<pre><code class=\"highlight powershell\"><span class=\"comment\"># File: InvokeApi.ps1</span>\n\n<span class=\"comment\"># 設定 URL</span>\n<span class=\"variable\">$url</span> = <span class=\"string\">&quot;your api url&quot;</span>\n<span class=\"comment\"># 設定 Log Path</span>\n<span class=\"variable\">$logFile</span> = <span class=\"string\">&quot;C:\\Scripts\\InvokeApi.log&quot;</span>\n\n<span class=\"comment\"># 調用 API</span>\n<span class=\"keyword\">try</span> &#123;\n    <span class=\"variable\">$response</span> = <span class=\"built_in\">Invoke-WebRequest</span> <span class=\"literal\">-Uri</span> <span class=\"variable\">$url</span> <span class=\"literal\">-Method</span> Get <span class=\"literal\">-TimeoutSec</span> <span class=\"number\">10</span>\n    <span class=\"variable\">$logEntry</span> = <span class=\"string\">&quot;<span class=\"variable\">$</span>(Get-Date) - API call successfully: <span class=\"variable\">$</span>(<span class=\"variable\">$response</span>.StatusCode)&quot;</span>\n&#125; <span class=\"keyword\">catch</span> &#123;\n    <span class=\"variable\">$logEntry</span> = <span class=\"string\">&quot;<span class=\"variable\">$</span>(Get-Date) - API call failed: <span class=\"variable\">$</span>(<span class=\"variable\">$_</span>.Exception.Message)&quot;</span>\n&#125;\n\n<span class=\"comment\"># 寫入日誌</span>\n<span class=\"variable\">$logEntry</span> | <span class=\"built_in\">Out-File</span> <span class=\"literal\">-FilePath</span> <span class=\"variable\">$logFile</span> <span class=\"literal\">-Append</span>\n</code></pre>\n<ul>\n<li>回收後，應用關閉事件添加應用重啟<br>\n<img src=\"/images/aplstart.png\" alt=\"aplstart.png\"></li>\n</ul>\n<h2 id=\"參考資料\">參考資料</h2>\n<p><a href=\"https://www.quartz-scheduler.net/\">https://www.quartz-scheduler.net/</a><br>\n<a href=\"https://stackoverflow.com/questions/75443765/quartz-aspnetcore-and-hosting-in-asp-net-core\">https://stackoverflow.com/questions/75443765/quartz-aspnetcore-and-hosting-in-asp-net-core</a><br>\n<a href=\"https://blog.csdn.net/qq_18932003/article/details/139672249\">https://blog.csdn.net/qq_18932003/article/details/139672249</a></p>\n","categories":["CSharp"],"tags":["CSharp","Quartz"]},{"title":"C# 使用IdGen產生Id(雪花算法)","url":"/2024/11/19/snowflake/","content":"<h1>雪花算法</h1>\n<h2 id=\"概述\">概述</h2>\n<p>公司的資料表常常使用很奇怪的欄位來去當識別鍵(例如時間戳)，既然都用時間戳了不如用雪花算法產 ID 當 PK<br>\n雪花算法是 Twitter 開源的生成分散式全域產生 ID 的演算法</p>\n<h2 id=\"格式\">格式</h2>\n<p>雪花 ID 有 64 位元</p>\n<ul>\n<li>1 位為符號位始終是 0</li>\n<li>41 位為時間戳，精度毫秒</li>\n<li>10 位可為(10 位機器 ID) 或 (5 位數據中心 ID + 5 位機器 ID)，可識別 1024 台機器</li>\n<li>12 位為序列號 =&gt; 代表每毫秒可以有 4096 個 ID</li>\n</ul>\n<p><img src=\"/images/snowflake.png\" alt=\"snowflake_structure.image\"></p>\n<h2 id=\"優缺點\">優缺點</h2>\n<h3 id=\"優點\">優點</h3>\n<ol>\n<li>ID 包含時間戳，有序可排序</li>\n<li>簡單速度快</li>\n</ol>\n<h3 id=\"缺點\">缺點</h3>\n<ol>\n<li>依賴系統時間，如果系統時間回退或跳躍，會產生不唯一 ID</li>\n<li>自己手動分配機器 ID，分配不當，產生不唯一 ID</li>\n</ol>\n<h2 id=\"Install\">Install</h2>\n<pre><code class=\"highlight ada\">dotnet add <span class=\"keyword\">package</span> <span class=\"title\">IdGen</span></code></pre>\n<h2 id=\"DI-注入-Optionl\">DI 注入(Optionl)</h2>\n<pre><code class=\"highlight ada\">dotnet add <span class=\"keyword\">package</span> <span class=\"title\">IdGen.DependencyInjection</span></code></pre>\n<h2 id=\"Usage\">Usage</h2>\n<h3 id=\"一般\">一般</h3>\n<pre><code class=\"highlight C#\"><span class=\"keyword\">var</span> generator = <span class=\"keyword\">new</span> IdGenerator(<span class=\"number\">0</span>);\n<span class=\"keyword\">var</span> id = generator.CreateId();</code></pre>\n<h3 id=\"依賴注入\">依賴注入</h3>\n<p>Program.cs</p>\n<pre><code class=\"highlight C#\">builder.Services.AddIdGen(<span class=\"number\">0</span>);</code></pre>\n<p>Example.cs</p>\n<pre><code class=\"highlight C#\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Example</span>\n&#123;\n    <span class=\"comment\">//private readonly IIdGenerator&lt;long&gt; idGenerator;</span>\n    <span class=\"comment\">//public Example (IIdGenerator&lt;long&gt; idGenerator)</span>\n    <span class=\"comment\">//&#123;</span>\n    <span class=\"comment\">//    this.idGenerator = idGenerator;</span>\n    <span class=\"comment\">//&#125;</span>\n\n    <span class=\"keyword\">private</span> <span class=\"keyword\">readonly</span> IdGenerator idGenerator;\n    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Example</span>(<span class=\"params\">IdGenerator idGenerator</span>)</span>\n    &#123;\n        <span class=\"keyword\">this</span>.idGenerator = idGenerator;\n    &#125;\n\n    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"built_in\">long</span> <span class=\"title\">GetId</span>()</span>\n    &#123;\n        <span class=\"keyword\">var</span> id = idGenerator.CreateId();\n        <span class=\"keyword\">return</span> id;\n    &#125;\n&#125;</code></pre>\n<h2 id=\"參考資料\">參考資料</h2>\n<p><a href=\"https://github.com/RobThree/IdGen?tab=readme-ov-file\">https://github.com/RobThree/IdGen?tab=readme-ov-file</a></p>\n","categories":["CSharp"],"tags":["CSharp","演算法"]},{"title":"C# 使用Winscp上傳檔案","url":"/2024/11/19/winscp/","content":"<h2 id=\"概述\">概述</h2>\n<p>接手了前輩的專案，以前都要自己手動上傳檔案，好麻煩<br>\n因此來看看怎麼用 Winscp 套件來串接，配合後續製作成排程程式，自動上傳</p>\n<h2 id=\"Install\">Install</h2>\n<pre><code class=\"highlight powershell\">dotnet add package WinSCP</code></pre>\n<h2 id=\"Example\">Example</h2>\n<pre><code class=\"highlight C#\"><span class=\"comment\">// 連線設定</span>\nSessionOptions sessionOptions = <span class=\"keyword\">new</span> SessionOptions\n&#123;\n    Protocol = Protocol.Sftp,\n    HostName = <span class=\"string\">&quot;hostname&quot;</span>,\n    PortNumber = port,\n    UserName = <span class=\"string\">&quot;xxxx&quot;</span>,\n    SshHostKeyFingerprint = <span class=\"string\">&quot;ssh-rsa 2048 xxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span>,\n    SshPrivateKeyPath = <span class=\"string\">&quot;....&quot;</span> <span class=\"comment\">// 私鑰路徑自行調整(選用)</span>\n&#125;;\n\n<span class=\"comment\">// 開啟會話</span>\n<span class=\"keyword\">using</span> <span class=\"keyword\">var</span> session = <span class=\"keyword\">new</span> Session();\nsession.Open(sessionOptions);\n\n<span class=\"comment\">// 定義上傳的文件路徑和遠端目錄</span>\n<span class=\"built_in\">string</span> localFilePath = <span class=\"string\">&quot;文件路徑&quot;</span>;\n<span class=\"built_in\">string</span> remoteDirectory = <span class=\"string\">&quot;伺服器目錄&quot;</span>; <span class=\"comment\">// 遠端伺服器的目錄</span>\n\n<span class=\"comment\">// 上傳文件</span>\nTransferOperationResult transferResult;\ntransferResult = <span class=\"keyword\">this</span>.session.PutFiles(localFilePath, remoteDirectory);\n\n<span class=\"comment\">// 檢查上傳是否成功</span>\ntransferResult.Check();</code></pre>\n<h2 id=\"參考資料\">參考資料</h2>\n<p><a href=\"https://winscp.net/eng/docs/library#csharp\">https://winscp.net/eng/docs/library#csharp</a></p>\n","categories":["CSharp"],"tags":["CSharp","Winscp"]},{"title":"categories","url":"/categories/index.html","content":""},{"title":"標籤","url":"/tags/index.html","content":""}]